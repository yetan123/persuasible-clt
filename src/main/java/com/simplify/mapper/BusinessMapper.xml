<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.simplify.mapper.BusinessMapper">

    <resultMap id="BusinessAndCustomerAndCustomer" type="com.simplify.model.dto.BusinessVO">
        <id property="id" column="id"/>
        <result property="businessName" column="BUSINESS_NAME"/>
        <result property="estimatedSales" column="ESTIMATED_SALES"/>
        <result property="estimatedDate" column="ESTIMATED_Date"/>
        <result property="estimatedSuccess" column="ESTIMATED_SUCCESS"/>
        <result property="findDate" column="FIND_DATE"/>
        <result property="businessDescription" column="BUSINESS_DESCRIPTION"/>
        <result property="businessType" column="business_type"/>
        <result property="businessPhases" column="BUSINESS_PHASES"/>
        <result property="businessState" column="BUSINESS_STATE"/>
        <result property="createTime" column="CREATE_TIME"/>

        <association property="userBusinessVO" javaType="UserBusinessVO">
            <id property="id" column="userId"/>
            <result property="username" column="USERNAME"/>
        </association>

        <association property="customerBusinessVO" javaType="CustomerBusinessVO">
            <id property="id" column="customerId"/>
            <result property="companyName" column="COMPANY_NAME"/>
        </association>
    </resultMap>

    <select id="listBusiness" resultMap="BusinessAndCustomerAndCustomer">
       SELECT
        bu.ID,
        bu.BUSINESS_NAME,
        cu.id customerId,
        cu.COMPANY_NAME,
        bu.BUSINESS_TYPE,
        bu.BUSINESS_PHASES,
        bu.ESTIMATED_SALES,
        bu.ESTIMATED_DATE,
        bu.ESTIMATED_SUCCESS,
        bu.BUSINESS_STATE,
        bu.CREATE_TIME,
        u.USERNAME,
        u.id userId
    FROM
	TB_BUSINESS bu
	INNER JOIN TB_CUSTOMER cu ON bu.CUSTOMER_ID = cu.ID
	INNER JOIN TB_USER u ON bu.USER_ID = u.id
	Order BY bu.ID
    </select>

    <select id="listBusinessById" resultMap="BusinessAndCustomerAndCustomer">
        SELECT
            bu.ID,
            bu.BUSINESS_NAME,
            cu.id customerId,
            cu.COMPANY_NAME,
            bu.BUSINESS_TYPE,
            bu.BUSINESS_PHASES,
            bu.ESTIMATED_SALES,
            bu.ESTIMATED_DATE,
            bu.ESTIMATED_SUCCESS,
            bu.BUSINESS_STATE,
            bu.CREATE_TIME,
            u.USERNAME,
            u.id userId
        FROM
            TB_BUSINESS bu
            INNER JOIN TB_CUSTOMER cu ON bu.CUSTOMER_ID = cu.ID
            INNER JOIN TB_USER u ON bu.USER_ID = u.id
        WHERE
	u.id =#{id}
    </select>

    <delete id="deleteBusinessById" parameterType="java.lang.Long">
        DELETE FROM TB_BUSINESS WHERE ID=#{id}
    </delete>

    <insert id="insertBusiness">
        INSERT INTO TB_BUSINESS
        (id,business_name,estimated_sales,estimated_date,estimated_success,find_date,business_description,
        user_id,business_source_id,customer_id,business_type)
        VALUES
            (
            #{id},
            #{businessName},
            #{estimatedSales},
            #{estimatedDate},
            #{estimatedSuccess},
            #{findDate},
            #{businessDescription},
            #{userId},
            #{businessSourceId},
            #{customerId},
            #{businessType}
            )
    </insert>

    <update id="updateBusiness">
        update tb_business set business_name = #{businessName},estimated_sales = #{estimatedSales},
        estimated_date = #{estimatedDate},estimated_success = #{estimatedSuccess},find_date = #{findDate},
        business_description = #{businessDescription},business_source_id = #{businessSourceId},customer_id = #{customerId},
        business_type = #{businessType} where id = #{id}
    </update>
</mapper>